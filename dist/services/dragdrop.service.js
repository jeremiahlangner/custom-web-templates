(()=>{var i=class{static async getProvider(e){return await i._providers[e]}static load(){this._services=window.vcdc.services}static async getService(e){return i.load(),console.log(e,await i._services[e]),await i._services[e]}static registerServices(e){for(let t in e)this.registerService(t,e[t])}static registerService(e,t){i._services[e]=t,!window.vcdc.services[e]&&(window.vcdc.services[e]=t)}},n=i;n._providers={Application:Promise.resolve(window.vcdc)},n._services={};var o=class{constructor(e,t,s){this.selectEvents=[];this.elementEvents=[];this.dragEvents=[];this.resizeEvents=[];this.el=e,this.parentElement=this.el.parentElement,this.parentElement&&(this.initialIndex=Array.from(this.parentElement.children)?.indexOf(this.el)),this.dragExceptions=s,this.init(),this.registerSelectEvents()}async init(){this.componentService=await n.getService("ComponentService")}registerSelectEvents(){this.el.ondragstart=()=>!1,this.el.onmouseover=s=>{s.stopPropagation(),this.hovering=!0,this.el.classList.add("hovered")},this.el.onmouseout=s=>{s.stopPropagation(),this.hovering=!1,this.el.classList.remove("hovered")};let e=this.select.bind(this),t=this.select.bind(this);this.elementEvents.push(["click",e]),this.selectEvents.push(["click",t]),this.el.addEventListener("click",e),document.addEventListener("click",t)}select(e){e.stopPropagation(),document.dispatchEvent(new Event("click")),!(e.target.tagName in this.dragExceptions)&&(this.selected=!0,this.el.classList.add("selected"),this.registerSelectedEvents())}deselect(e){(!e.target||e.target!==this.el)&&(this.selected=!1,this.el.classList.remove("selected"))}deRegisterSelectEvents(){this.el.onmouseover=null,this.el.onmouseout=null;for(let e of this.elementEvents)this.el.removeEventListener(e[0],e[1]);for(let e of this.selectEvents)document.removeEventListener(e[0],e[1])}registerSelectedEvents(){this.registerResizeEvents(),this.registerDragEvents()}deRegisterSelectedEvents(){this.deRegisterResizeEvents(),this.deRegisterDragEvents()}registerResizeEvents(){let e=t=>{let s=this.el.getBoundingClientRect();t.clientX<s.left&&t.clientX>s.left-8||t.clientX<s.right+8&&t.clientX>s.right-8?document.body.style.cursor="ew-resize":t.clientY<s.top+8&&t.clientY>s.top-8||t.clientY<s.bottom+8&&t.clientY>s.bottom-8?document.body.style.cursor="ns-resize":document.body.style.cursor="initial"};this.resizeEvents.push(["mousemove",e]),document.addEventListener("mousemove",e)}deRegisterResizeEvents(){for(let e of this.resizeEvents)document.removeEventListener(e[0],e[1])}registerDragEvents(){this.el.onmousedown=e=>{e.stopPropagation(),document.body.style.cursor="move",this.el.initialDisplayStyle=this.el.style.display,this.dragging=!0;let t=this.mousemove.bind(this),s=this.mouseup.bind(this);this.dragEvents.push(["mousemove",t]),this.dragEvents.push(["mouseup",s]),document.addEventListener("mousemove",t),document.addEventListener("mouseup",s)}}mousemove(e){if(!this.dragging)return;this.el.style.display="none";let t=document.elementFromPoint(e.clientX,e.clientY)?.closest(this.selector);if(this.el.style.display="initial",!t||t.id==this.el.id)return;let s=t.parentElement;if(!!s)try{e.clientX<s.getBoundingClientRect().left+s.offsetWidth/2||e.clientY<s.getBoundingClientRect().top-s.offsetHeight/2?s.insertBefore(this.el,t):s.insertBefore(this.el,t.nextSibling)}catch{}}mouseup(e){this.dragging=!1,document.body.style.cursor="initial";for(let t of this.dragEvents)document.removeEventListener(t[0],t[1])}deRegisterDragEvents(){this.dragging=!1,this.el.onmousedown=null;for(let e of this.dragEvents)document.removeEventListener(e[0],e[1])}destroy(){this.deRegisterDragEvents(),this.deRegisterResizeEvents(),this.deRegisterSelectedEvents(),this.deRegisterSelectEvents()}};})();
